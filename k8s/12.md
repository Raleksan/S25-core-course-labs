# Lab 12

## Task 1: Upgrade Application for Persistence

To solve first task I updated application on `app_python` to implement `/visits` endpoint logic
and `monitoring/docker-compose.yml` to include a new volume with `visits.txt` file.

## Task 2: ConfigMap via Environment Variables

For this task I created `moscow-time-python/files/config.json` with content:

```json
{
    "name": "Aleksandr",
    "surname": "Ryabov",
    "nickname": "Raleksan",
    "meme_pack": "https://gist.github.com/Raleksan/2069dac15b4aa2de5daedba183536e69"
}
```

After I created `moscow-time-python/templates/configmap.yaml`:

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-config
data:
  config.json: |
    {{ .Files.Get "files/config.json" | nindent 4 }}
```

and update `moscow-time-python/templates/deployment.yaml`:

- With `volume`

```yaml
    - volume:
    # some other volumes
        - name: config-volume
          configMap:
            name: {{ .Release.Name }}-config
```

- Volume mount

```yaml
    volumeMounts:
    - name: config-volume
        mountPath: /config/config.json
        subPath: config.json
```

Now I install `Helm` Chart and verify success:

```bash
[root@laptop:/home/raleksan/projects/S25-core-course-labs/k8s]# kubectl get pods
NAME                                    READY   STATUS    RESTARTS      AGE
moscow-python-6956569dcb-6np2b          2/2     Running   0             68s
vault-0                                 1/1     Running   3 (95m ago)   26h
vault-agent-injector-84b987db6f-lgp8x   1/1     Running   3 (95m ago)   26h

[root@laptop:/home/raleksan/projects/S25-core-course-labs/k8s]# kubectl exec moscow-python-6956569dcb-6np2b -- cat /config/config.json
Defaulted container "moscow-time-python" out of: moscow-time-python, vault-agent

{
    "name": "Aleksandr",
    "surname": "Ryabov",
    "nickname": "Raleksan",
    "meme_pack": "https://gist.github.com/Raleksan/2069dac15b4aa2de5daedba183536e69"
}
```

## Bonus task: ConfigMap via Environment Variables

### 1. Upgrade Bonus app_rust

To solve first task I updated application on `app_rust` to implement `/visits` endpoint logic
and `monitoring/docker-compose.yml` to include a new volume with `visits.txt` file.

### 2. ConfigMap via Environment Variables

